{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://vibecoding.local/schemas/execution_packet.schema.json",
  "title": "Feature Shaper â€” Execution Packet",
  "type": "object",
  "additionalProperties": false,
  "required": ["packet_id", "story_id", "squad", "tickets"],
  "properties": {
    "schema_version": { "type": "string", "default": "1.0.0" },
    "packet_id": {
      "type": "string",
      "pattern": "^[A-Za-z]{2,6}-\\d{1,6}(-[A-Za-z])?$",
      "description": "Unique packet ID, e.g., LP-023-A."
    },
    "story_id": { "type": "string" },
    "squad": {
      "type": "string",
      "description": "Target engineering squad responsible for this packet.",
      "pattern": "^[A-Za-z0-9._-]{2,64}$"
    },
    "modules": {
      "type": "array",
      "description": "List of module IDs implicated by this packet.",
      "items": { "type": "string" }
    },
    "sequence": {
      "type": "array",
      "items": { "type": "string" },
      "description": "Execution order hints (modules or ticket IDs)."
    },
    "dependencies": { "type": "array", "items": { "type": "string" } },
    "definition_of_ready": { "type": "array", "items": { "type": "string" } },
    "tickets": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": ["ticket_id", "type", "title", "acceptance_criteria_gherkin"],
        "properties": {
          "ticket_id": {
            "type": "string",
            "pattern": "^[A-Za-z]{2,6}-\\d{1,6}(-\\d{1,4})?$"
          },
          "type": { "type": "string", "enum": ["feature", "bug", "chore", "spike"] },
          "title": { "type": "string", "minLength": 3 },
          "definition_of_ready": { "type": "array", "items": { "type": "string" } },
          "acceptance_criteria_gherkin": {
            "type": "array",
            "minItems": 1,
            "items": { "type": "string" }
          },
          "interfaces": {
            "type": "object",
            "description": "Interface notes, e.g., DB schemas, events, APIs.",
            "additionalProperties": true,
            "properties": {
              "db": { "type": "string" },
              "event": {
                "oneOf": [
                  { "type": "string" },
                  { "type": "array", "items": { "type": "string" } }
                ]
              },
              "api": {
                "type": "array",
                "items": {
                  "type": "object",
                  "additionalProperties": false,
                  "required": ["method", "path"],
                  "properties": {
                    "method": { "type": "string" },
                    "path": { "type": "string" },
                    "request": { "type": "object" },
                    "response": { "type": "object" }
                  }
                }
              }
            }
          },
          "test_data": { "type": "object" },
          "nfr": { "type": "array", "items": { "type": "string" } },
          "flags": { "type": "array", "items": { "type": "string" } },
          "mini_adr": { "type": "string", "description": "Short rationale for a key decision." },
          "done_means": { "type": "array", "items": { "type": "string" } }
        }
      }
    },
    "nfr": { "type": "array", "items": { "type": "string" } },
    "flags": { "type": "array", "items": { "type": "string" } },
    "optional": {
      "type": "boolean",
      "description": "If true, packet can be skipped without failing the story."
    },
    "site_id": { "type": "string" },
    "created_at": { "type": "string", "format": "date-time" },
    "created_by": { "type": "string" }
  }
}
